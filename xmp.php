<?php
$var = '<?xml version="1.0"?><PidData> <Resp errCode="0" errInfo="Success" fCount="1" fType="0" nmPoints="61" qScore="98" /> <DeviceInfo dpId="MANTRA.MSIPL" rdsId="MANTRA.WIN.001" rdsVer="1.0.1" mi="MFS100" mc="MIIEFzCCAv+gAwIBAgIEAas/ADANBgkqhkiG9w0BAQsFADCB6TEqMCgGA1UEAxMhRFMgTWFudHJhIFNvZnRlY2ggSW5kaWEgUHZ0IEx0ZCA1MU0wSwYDVQQzE0RCIDIwMyBTaGFwYXRoIEhleGEgb3Bwb3NpdGUgR3VqYXJhdCBIaWdoIENvdXJ0IFMgRyBIaWdod2F5IEFobWVkYWJhZDESMBAGA1UECRMJQWhtZWRhYmFkMRAwDgYDVQQIEwdHdWphcmF0MRIwEAYDVQQLEwlUZWNobmljYWwxJTAjBgNVBAoTHE1hbnRyYSBTb2Z0ZWNoIEluZGlhIFB2dCBMdGQxCzAJBgNVBAYTAklOMB4XDTIwMDYxODE0NTY1NVoXDTIwMDYyODExMDEyOFowgbAxJTAjBgNVBAMTHE1hbnRyYSBTb2Z0ZWNoIEluZGlhIFB2dCBMdGQxHjAcBgNVBAsTFUJpb21ldHJpYyBNYW51ZmFjdHVyZTEOMAwGA1UEChMFTVNJUEwxEjAQBgNVBAcTCUFITUVEQUJBRDEQMA4GA1UECBMHR1VKQVJBVDELMAkGA1UEBhMCSU4xJDAiBgkqhkiG9w0BCQEWFXN1cHBvcnRAbWFudHJhdGVjLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMFGkSzmRvt3g3FxfGzfQ3Pw3awZx/gugahgb1XnI44M1NJu8lUeH03sPIfvlyaQTYn/Z+IkrDJJVI/PdsehCkD/Smmh1WsrafYaWQl2wDeuXl+VZhIvpX6P1IGE+M6LlsEaZJbm7aTPUfOmHA9qA2iUUp6BsXPDTTe3TLFhtE7cbJ4GcBFj/JQH84/ZOUvtaI91coXjKmKzMFyyRqu/tsZ1ifCiocxzLXuH94SpT+D+wwBcY8buHIGu5n2HofKOh4OsGFUoWJx9r+cZGu94nyrkZLdlvi9zJlFIVBEBu28+uFZe4TyliAU3fiUDEKQR7izx6g64VdE4QnwPtjtCJNcCAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAe8g6dm2cOhDTBgBXgnSPQTD4CvfpZvMcQCwoothkrrZ2JPYSEO6vdyGmy7Gl35bd9BLM6YtyomeTeosXwLUhBuRLeH6gNw5bCLjj47QlXZnoHpyx+fslydQTeWmNx2/WpLDXhCZ06KmygGoarLW0v3WU6Lc5NSHSu2nkq+7mcjxMAYtyNfauL0SqUAS+Z4tlgl/Tr5DREID2YPvLF0FK5iRF/LwuWN5LKqBzFtT87nHinNFeAlCxQvlPMDzwbhkCcl72LsX2R0/ByAwyGAwRXsi6ksmMBSTb83fgX+ImRcAymd1VkaBOEjnhwAsB9fSE8ajBPxVVLymGST3DURTJsQ==" dc="db321da2-269c-4ffb-aa54-dfa81f7df3f6"> <additional_info> <Param name="srno" value="0578989" /> <Param name="sysid" value="6E3FEBFACEFE60FFBFF0" /> <Param name="ts" value="2020-06-22T13:47:21+05:30" /> </additional_info> </DeviceInfo> <Skey ci="20221021">NOHkjm+lT97hHNDjtX7IF/jHEeu2bKulLMvliIVq5HnU5ZBtJTJOwRWPJ+MfBpbOZ7MI1HCw1WIMB/Ftnev9LitUlsX97RePtduW5orTLAghBAJ2S3CAB0vS0NXMPdGphef/di5EiHiyGIkqkQ9Yn7PJw5M94n6HE9aHOgIKlF/TZvlwzhmhVcT5xGF9a8UFn0jEp4BYX9sP+mHCIUoc0L1IDLiAYldDETfW6jLoVjsj4yw7icvdyWFftnThMzHEARVe0DR/CL3gB97hPjBjsfdIvAjRFWnPVADYLtfCImUSo1t+iArnaQPPsZBO7k7ZjU7UF7h5t2+93gPrmsscvw==</Skey> <Hmac>EGnyVxb0UeqpnxhKJhqIUBhHT6VWb3+VCLLeC+98LjYcMwJXYjNzSVUDYE3+zv6k</Hmac> <Data type="X">MjAyMC0wNi0yMlQxMzo0NzoyMUrtKWtPpSVsRFJwpMqlTxF/GiXAzhQZj4vqFAgGSGP2tsPSf0IYZvfmm9oLHSZsTLebT+TVRlTNtF2erZmNTf/dcRXF2CX4la992tX6eQBp9IwdWUIXP+eRCwava+StRVRiGt4AiA8qOrMyeOIYFlSQKeLkN6J3M8s5S+ooadcJIHj139FOvoi27gT66UKW25TJ73/Y9Oa1MIkovoWGAc+QRrx3gwN+eeBt0aPlF7GQpbamd16937cIqAf6JmVW53V2lTJPLNQ2jqOOuXXz6IUDGbbolU3a5/tPzpDljxEvogYLcZBIrBVVAI7/Rl8p+yz94TA/Qia3bG8yKrtYxT/H0gY6jPwivfOAEx418ytQuLzR4ngjbeKccdvOcl63bnDIFgRy1sLBzD7QAu7hPoB1l5B8zcGtfkbzf5ZVhl3UdM71vtqKEWRUCBpyNtkGIC3D8tM5cVhXprEeyVAkn8VOgfX3kTl85CTdFPACdDlaDiAxmlcBY3OSWcschEqfpX9VlvBLGxw5KT68MYRKCsz9Y1aknceNUggno+iLl2h2n32fQQu+P9zhTKf2CaGmZY02qJE5GXtD9CCX+rTk7iesRat+HfKMEBC3gRYx4FGc3zIy3q9dmAO9QUETu0ZQ9ki3TaMds/5ndIEvrwcft1UP38N9QeSreviruZCiCepSU7CCRM8uoWW04uOHh/WAayr+JjoUB+VSDMarsIY7VNkaC7yWgv5xjV2878FZEbHd/PYSxdQfF4jkU1VqlUYeU5HVOEo8RqNwz1jaLlyd0xuK+UrC4IcslnzqO9zK7m+vnO1bP0BjPNu0kuCkslfeqpryAqWDPbcRkAogBc/W7YxgSF2hb6bvRa0v1f0GV1t9+w2i4S2y+TAE/JKyhhaEa1cFfWPEtQM4VAc20ZmgBsNZ17SS4GGfqLyz5NMrO5PRsREGzWFD5gHX7r9owGDEEP/N9j0oNvCBaMICuu+a8qk8rHQvhhxB60ujRgQtwM1fvFsy/tdvFhZk98kECgktRDSJUMmFklI+xK/s2HP2UNcIBES81fggOgFcAfG0JONYD4fXLdCamrcJIpAx0rHYuFxx46n3MzxyL0+qlgh/G1IAP/Gt4DMFD4E3cfwxbf9vCr3B1r+WOxW0TVn8QUdXIBXRZ05UqFsvttasfBknEfTLcTVbGMDLjI90wr/TteQJ4zSG7yW+yRWz0JXszsWNTgMP4YRieKhsCoA8uoLteug6YlWwjxsTqbhJnNmeT1B7DbdJ9wZuQbMcDs65ZjVob7jDt9XEajUOLX2C+YCfgce6i3aB+9W0hBhC8zHCWB9TkE4ZQsGEvtfz45IhpfcYm6vQKZJp/CFNzN7wEXpDgP411YHFZtFd8PkcdDax5YDtc0OFQGCM4gER+Fjv42GnH0DsTIWVzCAKhohkBvJ8j/oy1pDY9qVbEHez51y5v0tAzQtFD7jACu+OGxJhw+xfWOBJelMbrUMIlB4qJ7Nbhg8FpSK9e7KiUzNXow==</Data></PidData>';

print gettype($var);
$args = array();
$xml=simplexml_load_string($var) or die("Error: Cannot create object");

#print_r($xml);
$hmac = $xml->Hmac;
$sessionkey = $xml->Skey;
$data = $xml->Data;

$args["encHmac"] = "".$hmac."";
$args["encryptedPid"] = "$data";
$args["encSessionKey"] = "$sessionkey";

foreach($xml->DeviceInfo->additional_info->Param[0]->attributes() as $key => $value)
{
	if ($key == "value")
	{
		$s_no = $value;
		$args["serialnumber"] = "$s_no";
	}
}
foreach($xml->DeviceInfo->additional_info->Param[2]->attributes() as $key => $value)
{
	if ($key == "value")
	{
		$ts = $value;
	}
}
foreach($xml->DeviceInfo->attributes() as $key => $value) 
{ 
	$args["$key"] = "$value";
} 

$crt_tmp = explode("+", $ts);
$crt = str_replace("-", "/", str_replace("T", " ",$crt_tmp[0]));

#$tid_tmp = explode("+", $ts);
$tid = str_replace(":", "", str_replace("-", "", str_replace("T", "",$crt_tmp[0])));

$args["timeStamp"] = "$crt_tmp[0]";
$args["crt"] = "$crt.047";
$args["tid"] = "UKC:"."$tid"."421";
$args["ci"] = "20221021";

print_r($args);
?>
